<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Profil - Toko Fraaex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
    body { background: #0f172a; color: #e5e7eb; }

    header {
      position: sticky; top: 0; z-index: 50;
      background: rgba(15,23,42,0.9); backdrop-filter: blur(10px);
      color: #fff; padding: 12px 32px;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid rgba(148,163,184,0.3);
    }
    .logo { font-size: 22px; font-weight: bold; letter-spacing: 1px; }
    .logo span { color: #38bdf8; }
    nav { display: flex; gap: 18px; font-size: 14px; }
    nav a { text-decoration:none; color:inherit; }

    main {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 24px 40px;
    }

    .profile-card {
      background: #020617;
      border-radius: 18px;
      padding: 24px 24px 28px;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(15,23,42,0.9);
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 24px;
      align-items: center;
    }

    .avatar-wrap {
      width: 110px;
      height: 110px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: 700;
      color: #e5f3ff;
      border: 3px solid #0b1220;
      position: relative;
      overflow: hidden;
      background-size: cover;
      background-position: center;
    }

    /* style avatar bawaan */
    .avatar-style-1 {
      background: radial-gradient(circle at top, #38bdf8, #1d4ed8);
    }
    .avatar-style-2 {
      background: radial-gradient(circle at top, #a855f7, #4338ca);
    }
    .avatar-style-3 {
      background: radial-gradient(circle at top, #22c55e, #15803d);
    }

    .avatar-wrap.animate-change {
      animation: pop 0.35s ease-out;
    }
    @keyframes pop {
      0% { transform: scale(0.8); opacity: 0.4; }
      60% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); }
    }

    .profile-main-title {
      font-size: 20px;
      margin-bottom: 4px;
    }
    .profile-sub {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 14px;
    }

    .profile-info {
      margin-top: 10px;
      font-size: 13px;
      color: #e5e7eb;
    }
    .profile-info div { margin-bottom: 6px; }
    .label {
      display:inline-block;
      width: 90px;
      color:#9ca3af;
    }

    .profile-actions {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn-primary {
      background: linear-gradient(135deg,#38bdf8,#2563eb);
      color:#fff; border:none;
      padding:8px 16px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
    }
    .btn-outline {
      background:transparent;
      border-radius:999px;
      border:1px solid #4b5563;
      padding:8px 16px;
      font-size:13px;
      color:#e5e7eb;
      cursor:pointer;
    }
    .danger { color:#f97373; border-color:#f97373; }

    /* PILIHAN AVATAR */
    .avatar-chooser {
      margin-top: 20px;
      font-size: 13px;
    }
    .avatar-chooser-title {
      color:#9ca3af;
      margin-bottom: 6px;
    }
    .avatar-option-list {
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .avatar-option {
      width:42px;
      height:42px;
      border-radius:999px;
      cursor:pointer;
      border:2px solid transparent;
      position:relative;
      overflow:hidden;
      transition:border-color 0.2s, transform 0.15s;
    }
    .avatar-option:hover { transform: translateY(-1px); }
    .avatar-option.selected {
      border-color:#38bdf8;
      box-shadow:0 0 0 1px #0b1120;
    }
    .avatar-option.style-1 {
      background: radial-gradient(circle at top, #38bdf8, #1d4ed8);
    }
    .avatar-option.style-2 {
      background: radial-gradient(circle at top, #a855f7, #4338ca);
    }
    .avatar-option.style-3 {
      background: radial-gradient(circle at top, #22c55e, #15803d);
    }

    footer {
      border-top: 1px solid #1f2937;
      padding: 18px 32px;
      text-align: center;
      font-size: 11px;
      color: #6b7280;
      background: #020617;
    }

    @media (max-width: 640px) {
      .profile-card {
        grid-template-columns: 1fr;
        text-align: center;
      }
      .avatar-wrap { margin: 0 auto; }
      .profile-info { text-align:left; }
      .avatar-chooser { text-align:left; }
    }
  </style>

  <script>
    if (localStorage.getItem("isLoggedIn") !== "true") {
      window.location.href = "register.html";
    }
  </script>
</head>
<body>
  <header>
    <div class="logo">Toko<span>Fraaex</span></div>
    <nav>
      <a href="index.html">Beranda</a>
      <a href="produk.html">Produk</a>
      <a href="pembayaran.html">Pembayaran</a>
    </nav>
  </header>

  <main>
    <div class="profile-card">
      <div class="avatar-wrap avatar-style-1" id="avatarCircle">
        <span id="avatarInitial">ðŸ‘‹</span>
      </div>

      <!-- tombol & input untuk upload foto -->
      <div style="margin-left:16px;">
        <input
          type="file"
          id="avatarFileInput"
          accept="image/*"
          style="display:none"
        />
        <button class="btn-outline" onclick="document.getElementById('avatarFileInput').click()">
          Tambah/Ubah Foto Profil
        </button>
      </div>

      <div>
        <h1 class="profile-main-title" id="profileNameText">User</h1>
        <p class="profile-sub">
          Kelola nama, email, dan avatar akunmu di Toko Fraaex.
        </p>

        <div class="profile-info">
          <div><span class="label">Nama</span><span id="infoName">-</span></div>
          <div><span class="label">Email</span><span id="infoEmail">-</span></div>
        </div>

        <!-- PILIHAN AVATAR -->
        <div class="avatar-chooser">
          <div class="avatar-chooser-title">Ganti avatar animasi</div>
          <div class="avatar-option-list">
            <div class="avatar-option style-1 selected" data-style="1"></div>
            <div class="avatar-option style-2" data-style="2"></div>
            <div class="avatar-option style-3" data-style="3"></div>
          </div>
        </div>

        <div class="profile-actions">
          <button class="btn-primary" onclick="location.href='index.html'">
            Kembali ke Beranda
          </button>
          <button class="btn-outline" onclick="selesaiAturProfil()">
            Selesai
          </button>
          <button class="btn-outline danger" onclick="logout()">
            Logout
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2025 TokoFraa. Semua hak cipta dilindungi.
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const name  = localStorage.getItem("userName")  || "User";
      const email = localStorage.getItem("userEmail") || "-";
      const savedStyle = localStorage.getItem("avatarStyle") || "1";

      document.getElementById("profileNameText").textContent = name;
      document.getElementById("infoName").textContent        = name;
      document.getElementById("infoEmail").textContent       = email;

      const firstChar = name.trim().charAt(0).toUpperCase();
      document.getElementById("avatarInitial").textContent = firstChar;

      const avatarCircle   = document.getElementById("avatarCircle");
      const avatarFileInput = document.getElementById("avatarFileInput");
      const savedAvatarImage = localStorage.getItem("avatarImage");

      // jika sebelumnya sudah upload foto, pakai sebagai background
      if (savedAvatarImage) {
        avatarCircle.style.backgroundImage = `url(${savedAvatarImage})`;
        document.getElementById("avatarInitial").style.display = "none";
        avatarCircle.classList.remove("avatar-style-1","avatar-style-2","avatar-style-3");
      }

      function applyStyle(style) {
        avatarCircle.classList.remove("avatar-style-1","avatar-style-2","avatar-style-3");
        avatarCircle.classList.add("avatar-style-" + style);

        // hapus foto jika kembali ke style animasi
        avatarCircle.style.backgroundImage = "";
        document.getElementById("avatarInitial").style.display = "block";

        avatarCircle.classList.remove("animate-change");
        void avatarCircle.offsetWidth;
        avatarCircle.classList.add("animate-change");
        localStorage.removeItem("avatarImage");
      }

      // set style dari localStorage pertama kali jika belum upload foto
      if (!savedAvatarImage) {
        applyStyle(savedStyle);
      }

      const options = document.querySelectorAll(".avatar-option");
      options.forEach(opt => {
        if (opt.dataset.style === savedStyle && !savedAvatarImage) {
          opt.classList.add("selected");
        }

        opt.addEventListener("click", () => {
          const style = opt.dataset.style;
          localStorage.setItem("avatarStyle", style);
          applyStyle(style);

          options.forEach(o => o.classList.remove("selected"));
          opt.classList.add("selected");
        });
      });

      // handle upload foto dari device
      avatarFileInput.addEventListener("change", function () {
        const file = this.files[0];
        if (!file) return;
        if (!file.type.startsWith("image/")) {
          alert("Silakan pilih file gambar.");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          const dataUrl = e.target.result;
          avatarCircle.style.backgroundImage = `url(${dataUrl})`;
          avatarCircle.classList.remove("avatar-style-1","avatar-style-2","avatar-style-3");
          document.getElementById("avatarInitial").style.display = "none";

          localStorage.setItem("avatarImage", dataUrl);
        };
        reader.readAsDataURL(file);
      });
    });

    function logout() {
      localStorage.removeItem("isLoggedIn");
      localStorage.removeItem("userName");
      localStorage.removeItem("userEmail");
      localStorage.removeItem("avatarStyle");
      localStorage.removeItem("avatarImage");
      window.location.href = "register.html";
    }

    function selesaiAturProfil() {
      const style = localStorage.getItem("avatarStyle") || "1";
      const name  = localStorage.getItem("userName")  || "User";
      const email = localStorage.getItem("userEmail") || "-";
      const hasPhoto = !!localStorage.getItem("avatarImage");

      // di sini bisa dikirim ke backend, saat ini hanya notifikasi
      alert(
        "Profil kamu sudah disimpan!\n" +
        "Nama: " + name + "\n" +
        "Email: " + email + "\n" +
        "Avatar: " + (hasPhoto ? "Foto dari perangkat" : "Style " + style)
      );
    }
  </script>
</body>
</html>
